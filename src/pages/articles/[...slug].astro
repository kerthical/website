---
import Layout from '@layouts/Layout.astro';
import { drizzle } from 'drizzle-orm/d1';
import { articles } from '../../schema';
import { eq } from 'drizzle-orm';
import Article from '@components/Article';

const slug = Astro.params['slug'];
if (!slug) {
  return Astro.redirect('/');
}
const db = drizzle(Astro.locals.runtime.env['D1']);

const result = (
  await db
    .select()
    .from(articles)
    .where(eq(articles.slug, slug))
    .limit(1)
)[0];

if (!result) {
  return Astro.redirect('/404');
}
---

<Layout title={`kerthical.com | ${result.title}`}>
  <Article client:load result={result} />
</Layout>
